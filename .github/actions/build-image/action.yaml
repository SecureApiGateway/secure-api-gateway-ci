name: Build Image
inputs:
  setMavenConfig:
    required: true
    type: string  
  repositoryName: 
    required: true
    type: string
  dockerBuildCommands:
    required: true
    type: string
  FR_ARTIFACTORY_USER:
    required: true
    type: string
  FR_ARTIFACTORY_USER_ENCRYPTED_PASSWORD:
    required: true
    type: string

runs:
  using: composite
  steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      with: 
        repository: ${{ inputs.repositoryName }}
        path: ${{ inputs.repositoryName }}
    # Optional
    - name: Set Java and Maven Cache
      uses: actions/setup-java@v4
      if: inputs.setMavenConfig == 'true'
      with:
        distribution: 'zulu'
        java-version: '17'
        architecture: x64
        cache: 'maven'
        server-id: forgerock-internal-releases # protected release repo
        server-username: FR_ARTIFACTORY_USER # env variable for username to authentication protected repo
        server-password: FR_ARTIFACTORY_USER_ENCRYPTED_PASSWORD # env variable encrypted password to authentication protected repo
    - name: Run Docker Commands
      shell: bash
      run: |
        cd ${{ inputs.repositoryName }}
        ${{ inputs.dockerBuildCommands }}
      env:
        FR_ARTIFACTORY_USER: ${{ inputs.FR_ARTIFACTORY_USER }}
        FR_ARTIFACTORY_USER_ENCRYPTED_PASSWORD: ${{ inputs.FR_ARTIFACTORY_USER_ENCRYPTED_PASSWORD }}