name: Nightly Build
on:
  workflow_dispatch:
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout CI Code
        uses: actions/checkout@v4  
      # Auth GCP, SDK & Artifact Registry
      - name: Auth to GCP
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.DEV_GAR_KEY }}
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2.1.0
      - name: Auth Docker
        run: |
          gcloud auth configure-docker europe-west4-docker.pkg.dev
      - name: Call build-image-and-artifact step for Core
        uses: ./.github/actions/build-image-and-artifact
        with: 
          repositoryName: secure-api-gateway-core
          FR_ARTIFACTORY_USER: ${{ secrets.FR_ARTIFACTORY_USER }}
          FR_ARTIFACTORY_USER_ENCRYPTED_PASSWORD: ${{ secrets.FR_ARTIFACTORY_USER_ENCRYPTED_PASSWORD }}